(this["webpackJsonpchat-application"]=this["webpackJsonpchat-application"]||[]).push([[0],{48:function(e,t,n){e.exports=n(98)},87:function(e,t){},91:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(44),o=n.n(c),s=n(23),i=n(7),l=n(2),m=n(13),u=n.n(m),d="http://localhost:5000",f={connection:"connection",disconnect:"disconnect",setOnline:"setOnline",join:"join",leave:"leave",message:"message",sendMessage:"sendMessage",roomData:"roomData",onlineUsers:"onlineUsers"},p={admin:1,sent:2,received:3};var v=function(e){var t=e.location,n=e.history,c=t.search,o=u.a.parse(c).room,s=void 0===o?"":o,i=Object(a.useState)("Please check your username"),m=Object(l.a)(i,2),f=(m[0],m[1]),p=Object(a.useRef)(null);function v(e){return p&&p.current&&p.current.value?(fetch("".concat(d,"/checkLogin"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:p.current.value})}).then((function(e){return e.json()})).then((function(e){200===e.status&&e.user.id?(f("Username found"),function(e){var t="";e&&s?t="/chat?user=".concat(e,"&room=").concat(s):e&&(t="/chat?user=".concat(e)),n.push(t)}(e.user.name)):400===e.status&&console.log(e.message,"error to join, please try again")})),null):(f("Please type your username"),e.preventDefault())}return r.a.createElement("div",{className:"h-100 d-flex justify-content-center flex-column p-5"},r.a.createElement("h1",{className:"text-center"},"Welcome"),r.a.createElement("hr",{className:"pt-4 pb-2 w-25 border-info"}),r.a.createElement("div",null,r.a.createElement("div",{className:"form-group d-flex flex-column"},r.a.createElement("input",{ref:p,type:"username",className:"form-control",id:"username",placeholder:"Type your username...",onKeyPress:function(e){return"Enter"===e.key&&v(e),null}})),s&&r.a.createElement("div",{className:"form-group d-flex flex-column align-items-center"},r.a.createElement("label",{htmlFor:"roomname",className:"p-0 m-0 font-weight-bold"},"Room"),r.a.createElement("input",{value:s,disabled:!0,type:"text",className:"form-control",id:"roomname",placeholder:"Join to room name..."})),r.a.createElement("div",{className:"text-center p-4 d-flex flex-column align-items-center"},r.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:v},"Let's go"))))},E=n(15),h=n(14),g=n(45),b=n.n(g),O=n(24),y=n.n(O),j="DD-MM-YYYY HH:MM";var N=function(e){var t=e.currentUser,n=e.userList,a=e.message,c=(a.id,a.sender_id),o=void 0===c?0:c,s=(a.room_id,a.content),i=void 0===s?"":s,l=a.created_at,m=void 0===l?"1975-01-01 00:00:00":l,u=(a.seen_by,!1);return o===t.id&&(u=!0),o===p.admin?r.a.createElement("li",{className:"admin"},r.a.createElement("p",null,i),r.a.createElement("span",null,y()(m).format(j))):function(e){var t="",a=n.filter((function(e){return e.id===o}))[0];return a&&(t=a.name),r.a.createElement("li",{className:u?"sent":"received"},!u&&r.a.createElement("img",{src:e.src,alt:e.name}),r.a.createElement("div",null,r.a.createElement("span",{className:"name"},u?"You":t),r.a.createElement("p",null,i),r.a.createElement("span",null,y()(m).format(j))),u&&r.a.createElement("img",{src:e.src,alt:e.name}))}({src:"img/avatar-male.png",name:"Avatar"})};var C=function(e){var t=e.currentUser,n=e.userList,c=e.currentRoom,o=e.messageList,s=Object(a.useRef)(null);return Object(a.useLayoutEffect)((function(){s&&(s.current.scrollTop=s.current.scrollHeight)}),[o]),r.a.createElement("div",{className:"messages",ref:s},r.a.createElement("ul",null,o&&o.filter((function(e){return e.room_id===c.id})).map((function(e){return r.a.createElement("div",{key:e.id},r.a.createElement(N,{currentUser:t,userList:n,message:e}))}))))};var k=function(e){var t=e.message,n=e.func,a=n.handleOnChangeMessage,c=n.handleOnKeyPressMessage,o=n.sendMessage;return r.a.createElement("div",{className:"message-input"},r.a.createElement("div",{className:"wrap"},r.a.createElement("input",{type:"text",placeholder:"Write your message...",value:t,onChange:a,onKeyPress:c}),r.a.createElement("button",{className:"submit",onClick:o},r.a.createElement("i",{className:"fa fa-paper-plane","aria-hidden":"true"}))))};var w=function(e){var t,n,a=e.currentUser,c=e.userList,o=e.currentRoom,s=e.message,i=e.messageList,l=e.func,m=l.handleClickLeaveRoom;function u(e){!function(e){try{var t=document.createElement("textarea");t.innerText=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove();var n="Copied to clipboard! ".concat(e);console.log(n,"success")}catch(a){console.log("Cannot copy to clipboard. Please try again!")}}("".concat(window.location.origin,"?room=").concat(encodeURI(e)))}return r.a.createElement("div",{className:"content"},Object.keys(o).length?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"contact-profile d-flex justify-content-between align-items-center pl-4 pr-4"},r.a.createElement("i",{className:"fa fa-share","aria-hidden":"true",onClick:function(){return u(o.name)}}),r.a.createElement("p",null,(t=o.room_type,n=o.name,1===t?"".concat(n.replace(a.name,"")):2===t?"".concat(n):void 0)),r.a.createElement("i",{className:"fa fa-close","aria-hidden":"true",onClick:function(){return m(o)}})),r.a.createElement(C,{currentUser:a,userList:c,currentRoom:o,messageList:i}),r.a.createElement(k,{message:s,func:l})):r.a.createElement("span",{className:"h-100 d-flex justify-content-center align-items-center"},"Message Chat"))};n(91);var R=function(e){var t=e.currentUser,n=e.currentRoom,a=e.conversationList,c=e.handleClickChooseRoom,o=a;return r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",null,o.map((function(e){return r.a.createElement("li",{key:e.id,className:"contact ".concat(n.name===e.name?"active":""),onClick:function(){return c(e)}},r.a.createElement("div",{className:"wrap"},r.a.createElement("div",{className:"meta"},r.a.createElement("p",{className:"name"},(a=e.type,o=e.name,1===a?"P2P: ".concat(o.replace(t.name,"")):2===a?"Group: ".concat(o):void 0)))));var a,o}))))};var x=function(e){var t=e.currentUser,n=e.userList,a=e.handleClickJoinP2P,c=n.filter((function(e){return e.name!==t.name}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"tag"},"Users"),r.a.createElement("ul",null,c.map((function(e){return r.a.createElement("li",{key:e.id,className:"contact",onClick:function(){return a(e)}},r.a.createElement("div",{className:"wrap"},r.a.createElement("span",{className:"contact-status online"}),r.a.createElement("img",{src:"img/avatar-male.png",alt:""}),r.a.createElement("div",{className:"meta"},r.a.createElement("p",{className:"name"},e.name))))}))))};var L=function(e){var t=e.currentUser,n=e.currentRoom,a=e.roomList,c=e.notificationRoom,o=e.handleClickChooseRoom,s=a,i=function(e){return!!(t&&t.id&&c&&Object.keys(c).length&&c[t.id])&&(Object.keys(c).includes(t.id)&&c[t.id].includes(e.id))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"tag"},"Groups"),r.a.createElement("ul",null,s.map((function(e){return r.a.createElement("li",{key:"room".concat(e.id),className:"contact ".concat(n.name===e.name?"active":""),onClick:function(){return o(e)}},r.a.createElement("div",{className:"wrap d-flex align-items-center justify-content-between"},r.a.createElement("div",{className:"meta"},r.a.createElement("p",{className:"name ".concat(i(e)?"text-bold":"")},e.name)),i(e)&&r.a.createElement("div",{className:"contact-status online"})))}))))},P={conversations:1,users:2};var U,D=function(e){var t=e.currentUser,n=e.userList,c=e.currentRoom,o=e.roomList,s=e.notificationRoom,i=e.conversationList,m=e.func,u=m.handleClickCreateRoom,d=m.handleClickJoinP2P,f=m.handleClickChooseRoom,p=m.handleClickDisconnect,v=Object(a.useState)(P.users),E=Object(l.a)(v,2),h=E[0],g=E[1];return r.a.createElement("div",{id:"sidepanel"},r.a.createElement("div",{id:"profile"},r.a.createElement("div",{className:"wrap d-flex flex-row justify-content-between"},r.a.createElement("div",null,r.a.createElement("img",{id:"profile-img",src:"img/avatar-male.png",className:"online",alt:""}),r.a.createElement("p",null,t.name)),r.a.createElement("div",null,r.a.createElement("i",{className:"fa fa-sign-out expand-button pr-3","aria-hidden":"true",onClick:p}),r.a.createElement("i",{className:"fa fa-plus expand-button pr-3","aria-hidden":"true",onClick:u})))),r.a.createElement("div",{id:"conversations"},h===P.conversations?r.a.createElement(R,{currentUser:t,currentRoom:c,conversationList:i,handleClickChooseRoom:f}):r.a.createElement(r.a.Fragment,null,r.a.createElement(x,{currentUser:t,userList:n,handleClickJoinP2P:d}),r.a.createElement(L,{currentUser:t,currentRoom:c,roomList:o,notificationRoom:s,handleClickChooseRoom:f}))),r.a.createElement("div",{id:"bottom-bar"},r.a.createElement("button",{id:"conversations",className:h===P.conversations?"active":"",onClick:function(){alert("TODO: Conversations (multi-channel) is coming soon")}},r.a.createElement("i",{className:"fa fa-exchange fa-fw","aria-hidden":"true"}),r.a.createElement("span",null,"Conversations")),r.a.createElement("button",{id:"users",className:h===P.users?"active":"",onClick:function(){return g(P.users)}},r.a.createElement("i",{className:"fa fa-users fa-fw","aria-hidden":"true"}),r.a.createElement("span",null,"Users & Groups"))))};function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(n,!0).forEach((function(t){Object(h.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J=function(e){var t=e.location,n=e.history,c=t.search,o=Object(a.useState)({}),s=Object(l.a)(o,2),i=s[0],m=s[1],p=Object(a.useState)([]),v=Object(l.a)(p,2),g=v[0],O=v[1],y=Object(a.useState)({}),j=Object(l.a)(y,2),N=j[0],C=j[1],k=Object(a.useState)([]),R=Object(l.a)(k,2),x=R[0],L=R[1],P=Object(a.useState)([]),M=Object(l.a)(P,2),J=M[0],T=(M[1],Object(a.useState)("")),F=Object(l.a)(T,2),_=F[0],Y=F[1],K=Object(a.useState)([]),W=Object(l.a)(K,2),A=W[0],G=W[1],H=Object(a.useState)([]),B=Object(l.a)(H,2),I=B[0],$=B[1],q=Object(a.useState)({}),z=Object(l.a)(q,2),Q=z[0],V=z[1];function X(e){e.preventDefault(),_&&U.emit(f.sendMessage,{user:i,room:N,message:_},(function(){return Y("")}))}return Object(a.useEffect)((function(){var e=u.a.parse(c),t=e.user,n=void 0===t?"":t,a=e.room,r=void 0===a?"":a;return(U=b()(d)).emit("userConnect",{userName:n,roomName:r},(function(e){var t=e.userRes,n=e.roomRes;t&&m(t),n&&C(n),U.on("getOnlineUsers",(function(e){return O(e)})),U.on("getAvailableRooms",(function(e){return L(e)}))})),function(){return function(e){U.emit("userDisconnect",e),U.emit(f.disconnect),U.disconnect()}(n)}}),[d,c]),Object(a.useEffect)((function(){U.on(f.message,(function(e){return G(e)}))}),[A]),Object(a.useEffect)((function(){U.on("notification",(function(e){var t=e.user,n=e.room,a=S({},Q,Object(h.a)({},t.id,Q[t.id]&&!Q[t.id].includes(n.id)?[].concat(Object(E.a)(Q[t.id]),[n.id]):[n.id]));V(a)}))}),[A]),Object(a.useEffect)((function(){var e,t;Object.keys(i).length&&Object.keys(N).length&&(e=i,t=N,U.emit(f.join,{user:e,room:t},(function(e){$([].concat(Object(E.a)(I),[e.id]))})))}),[N]),r.a.createElement(r.a.Fragment,null,r.a.createElement(D,{currentUser:i,userList:g,currentRoom:N,roomList:x,notificationRoom:Q,conversationList:J,func:{handleClickCreateRoom:function(e){e.preventDefault();var t=window.prompt("To create new room, please enter room name here");t&&U.emit("createNewRoom",{user:i,roomName:t,roomType:2},(function(e){return C(e)}))},handleClickJoinP2P:function(e){alert("TODO: P2P feature is coming soon")},handleClickChooseRoom:function(e){if(e&&(C(e),Q&&Q.room&&e.name===Q.room.name)){var t=Q[i.id].indexOf(e.id);t>-1&&Q[i.id].splice(t,1);var n=S({},Q,Object(h.a)({},i.id,Object(E.a)(Q[i.id])));V(n)}},handleClickDisconnect:function(e){e.preventDefault(),window.confirm("Are you sure you want to disconnect?")&&n.push("/")}}}),r.a.createElement(w,{currentUser:i,userList:g,currentRoom:N,message:_,messageList:A,func:{handleClickLeaveRoom:function(e){e&&U.emit(f.leave,{user:i,room:e},(function(e){C({})}))},handleOnChangeMessage:function(e){var t=e.target.value;Y(void 0===t?"":t)},handleOnKeyPressMessage:function(e){return"Enter"===e.key&&X(e),null},sendMessage:X}}))};var T=function(){return r.a.createElement(s.a,null,r.a.createElement(i.a,{path:"/",exact:!0,component:v}),r.a.createElement(i.a,{path:"/chat",component:J}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(96),n(97);o.a.render(r.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[48,1,2]]]);
//# sourceMappingURL=main.a55999c0.chunk.js.map